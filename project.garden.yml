kind: Project
name: flask-cockroachdb-example
defaultEnvironment: dev
variables:
  # change these values to your own
  username: worldofgeese
  terraformInitRoot: "./terraform/"
  registryHostname: docker.io
  registryNamespace: worldofgeese
  gcpProjectId: devrel-348008
  gcpRegion: asia-northeast1 # Google Cloud Run is only available in some regions. If you receive HTTP errors on deploy, change your region.
  

environments:
  - name: dev
    defaultNamespace: flask-cockroachdb-example-${variables.username}
  - name: prod
    defaultNamespace: flask-cockroachdb-example
    production: true

providers:
  - name: terraform
    autoApply: "${environment.name == 'dev' ? true : false}" # <--- We only recommend using `autoApply` for private development environments, since otherwise you may accidentally apply hazardous changes, or conflict with other users of an environment.
    # This must be set to indicate that there is a stack in the folder named terraform.
    initRoot: "${var.terraformInitRoot}"
    allowDestroy: true
    # You can either uncomment and replace these with your own values, or provide the values in a
    # terraform.tfvars file in the project root.
    variables:
      project_id: ${var.gcpProjectId}
      region: ${var.gcpRegion}

  - name: kubernetes
    context: ${providers.terraform.outputs.cluster_name}
    kubeconfig: ${var.terraformInitRoot}/${providers.terraform.outputs.kubeconfig_path}
    namespace: ${environment.namespace}
    deploymentRegistry:
      hostname: "${var.registryHostname}"
      namespace: "${var.registryNamespace}"

  - name: pulumi
    version: null # Set to `null` to use whichever version of `pulumi` is on your PATH.
       
